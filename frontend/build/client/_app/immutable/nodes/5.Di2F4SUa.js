import{a as c,f as u,s as g,e as C,c as na}from"../chunks/CXN8AEkE.js";import{i as re}from"../chunks/Ba5BHlZf.js";import{o as ne}from"../chunks/PPGuM6Ad.js";import{m as se,E as oe,F as le,n as Kt,w as q,a as t,o as ve,r,q as i,s as o,t as a,u as l,x as sa,v as p,G as z,y as Ma}from"../chunks/DrZxtosp.js";import{i as b}from"../chunks/C09UTFEA.js";import{e as At,i as Ft}from"../chunks/BnX6E_pk.js";import{r as H,a as Ct}from"../chunks/DJ05b8fX.js";import{s as Na}from"../chunks/CGYafap6.js";import{b as P}from"../chunks/BMwTRFU8.js";import{b as oa}from"../chunks/D0pToFsK.js";import{p as ka}from"../chunks/CWmzcjye.js";import{s as de,a as ce}from"../chunks/DbI0K5eF.js";import{a as Q,s as _e}from"../chunks/C0-kHXY5.js";import{i as Ta,a as ue,g as pe,b as Sa,w as qa}from"../chunks/BLUhCEgd.js";var fe=u('<p class="hint"> </p>'),ge=u('<p class="hint">Kennung wird automatisch vergeben.</p>'),be=u('<div class="card"><h3 class="section-title">Material anlegen</h3> <form class="form-grid"><div class="field"><label for="name">Name</label> <input id="name" class="input" required/></div> <div class="field"><label for="category">Kategorie</label> <input id="category" class="input" required/></div> <div class="field"><label for="location">Lagerort</label> <input id="location" class="input" required/></div> <div class="field"><label for="quantity">Menge</label> <input id="quantity" class="input" type="number" min="0"/></div> <div class="field"><label for="minQuantity">Mindestmenge</label> <input id="minQuantity" class="input" type="number" min="0"/></div> <div class="field"><label for="condition">Zustand</label> <input id="condition" class="input" required/></div> <!> <button class="btn btn-primary" type="submit">Material anlegen</button></form></div>'),me=u("<p>Lade Material...</p>"),he=u("<p> </p>"),ye=u("<p>Kein Material vorhanden.</p>"),we=u("<th>Kennung</th>"),Me=u("<th>Aktion</th>"),Ne=u('<button class="btn btn-outline" type="button">NFC schreiben</button>'),ke=u("<td> </td>"),Te=u('<td><button class="icon-btn" type="button" aria-label="Löschen"><svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 7h12l-1 14H7L6 7zm3-3h6l1 2H8l1-2z"></path></svg></button></td>'),Se=u('<tr><td> </td><td><span class="badge badge-secondary"> </span></td><td> </td><td> </td><td> </td><td><div class="cell-stack"><span> </span> <div class="cell-actions"><!></div></div></td><!><!></tr>'),qe=u('<div class="table-wrap"><table class="table"><thead><tr><th>Name</th><th>Kategorie</th><th>Lagerort</th><th>Menge</th><th>Mindestmenge</th><th>Zustand</th><!><!></tr></thead><tbody></tbody></table></div>'),Be=u('<div class="card"><h3 class="section-title">Box anlegen</h3> <form class="form-grid"><div class="field"><label for="boxName">Name</label> <input id="boxName" class="input" required/></div> <div class="field"><label for="boxDescription">Beschreibung</label> <input id="boxDescription" class="input"/></div> <button class="btn btn-primary" type="submit">Box anlegen</button></form></div>'),xe=u("<p>Keine Daten vorhanden.</p>"),De=u('<button class="icon-btn" type="button" aria-label="Löschen"><svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 7h12l-1 14H7L6 7zm3-3h6l1 2H8l1-2z"></path></svg></button>'),Le=u('<button class="btn btn-outline" type="button">NFC auf Box schreiben</button>'),Ee=u('<div class="card"><p>Auf iOS erfolgt das Schreiben über die App NFC Tools.</p> <p>Der folgende Wert muss geschrieben werden:</p> <p class="hint"> </p> <p class="text-muted"> </p> <div class="actions"><button class="btn btn-outline" type="button">NFC Tools öffnen</button> <button class="btn btn-outline" type="button">App Store öffnen</button></div></div>'),Ke=u('<p class="hint"> </p>'),Ae=u("<option> </option>"),Fe=u('<button class="btn btn-outline" type="button">Entfernen</button>'),Ce=u('<div class="actions actions-between"><span> </span> <div class="actions"><span class="badge badge-secondary"> </span> <!></div></div>'),$e=u('<p class="text-muted">Keine Daten vorhanden.</p>'),Oe=u('<div class="card"><div class="actions actions-between"><div><strong> </strong> <p class="text-muted"> </p></div> <!></div> <div class="actions"><span class="badge badge-secondary"> </span> <!></div> <!> <!> <div class="card-grid"><div class="field"><label>Material</label> <select class="select"><option>Auswahl</option><!></select></div> <div class="field"><label>Menge</label> <input class="input" type="number" min="1"/></div> <button class="btn btn-outline" type="button">Zuordnen</button></div> <div class="card-grid"><!></div></div>'),ze=u('<div class="card-grid"></div>'),He=u('<section class="card"><p class="hint"> </p></section>'),Pe=u('<section class="card activity-card"><div></div> <div class="activity-content"><span class="badge badge-secondary">Letzte Änderung</span> <div><strong> </strong> <!></div></div></section> <section class="card-grid grid-2"><!> <div class="card"><h3 class="section-title">Sortierung</h3> <div class="form-grid"><div class="field"><label for="sortKey">Sortieren nach</label> <select id="sortKey" class="select"><option>Name</option><option>Kategorie</option><option>Lagerort</option><option>Menge</option><option>Mindestmenge</option><option>Zustand</option><option>Kennung</option></select></div> <div class="field"><label for="sortDir">Richtung</label> <select id="sortDir" class="select"><option>Aufsteigend</option><option>Absteigend</option></select></div></div></div></section> <section class="card"><!></section> <section class="card-grid grid-2"><!> <div class="card"><h3 class="section-title">Boxen</h3> <!></div></section> <!>',1);function ei(Ba,xa){se(xa,!1);const B=()=>ce(_e,"$session",Da),[Da,La]=de(),yt=p();let R=p([]),wt=p([]),$t=p(!1),la=p(!1),Ot=p(!0),j=p(""),x=p({nfc_enabled:!1}),_t=p(""),Mt=p(""),Nt=p(""),kt=p(1),Tt=p(0),St=p(""),E=p(""),D=p({}),zt=p(null),$=p({type:"none",message:"Noch keine Änderungen.",time:""}),ut=p("name"),qt=p("asc"),pt=p(!1);const it=e=>e==="admin"||e==="materialwart",U=async()=>{o(Ot,!0),o(j,"");try{const[e,s,f]=await Promise.all([Q("/api/inventory"),Q("/api/settings").catch(()=>[]),Q("/api/boxes")]);o(R,e),o(wt,f),o(pt,t(R).length===0),t(pt)&&setTimeout(()=>o(pt,!1),3e3);for(const n of s)n.key==="nfc_enabled"&&z(x,t(x).nfc_enabled=n.value==="true")}catch{o(j,"Material konnte nicht geladen werden."),setTimeout(()=>o(j,""),3e3)}finally{o(Ot,!1)}},va=(e,s)=>{o($,{type:e,message:s,time:new Date().toLocaleString("de-DE")})},Ea=async()=>{try{await Q("/api/inventory",{method:"POST",body:JSON.stringify({name:t(_t),category:t(Mt),location:t(Nt),quantity:Number(t(kt)),min_quantity:Number(t(Tt)),condition:t(St)})}),va("created",`Materialeintrag angelegt: ${t(_t)}`),o(_t,""),o(Mt,""),o(Nt,""),o(kt,1),o(Tt,0),o(St,""),await U()}catch{o(j,"Materialeintrag konnte nicht erstellt werden.")}},Ka=async e=>{const s=t(R).find(f=>f.id===e);confirm("Materialeintrag wirklich löschen?")&&(await Q(`/api/inventory/${e}`,{method:"DELETE"}),va("deleted",`Materialeintrag gelöscht: ${(s==null?void 0:s.name)??e}`),await U())},Aa=async e=>{if(o(E,""),!e){o(E,"Keine Kennung verfügbar."),setTimeout(()=>o(E,""),3e3);return}try{if(!Sa()){o(E,"NFC nicht verfügbar."),setTimeout(()=>o(E,""),3e3);return}await qa(e),o(E,"Gespeichert."),setTimeout(()=>o(E,""),3e3)}catch{o(E,"Fehlgeschlagen."),setTimeout(()=>o(E,""),3e3)}},Fa=async()=>{try{if(!t(ft))return;await Q("/api/boxes",{method:"POST",body:JSON.stringify({name:t(ft),description:t(Bt)})}),o(ft,""),o(Bt,""),await U()}catch{o(j,"Box konnte nicht angelegt werden.")}},Ca=async e=>{confirm("Box wirklich löschen?")&&(await Q(`/api/boxes/${e}`,{method:"DELETE"}),await U())},$a=async e=>{t(Z)[e]&&(await Q(`/api/boxes/${e}/material`,{method:"POST",body:JSON.stringify({material_id:t(Z)[e],quantity:Number(t(rt)[e]||1)})}),z(Z,t(Z)[e]=""),z(rt,t(rt)[e]=1),await U())},Oa=async(e,s)=>{await Q(`/api/boxes/${e}/material/${s}`,{method:"DELETE"}),await U()},za=async e=>{const s=e.nfc_tag||pe(e.id);if(Ta()){o(zt,e.id),z(D,t(D)[e.id]="Auf iOS erfolgt das Schreiben über die App NFC Tools.");return}try{if(!Sa()){z(D,t(D)[e.id]="NFC nicht verfügbar.");return}await qa(s),z(D,t(D)[e.id]="Gespeichert.")}catch{z(D,t(D)[e.id]="Fehlgeschlagen.")}},Ha=()=>{window.location.href="nfctools://"},Pa=()=>{window.location.href="https://apps.apple.com/app/id1252962749"},Qa=e=>{const s=e.toLowerCase();return s.includes("gut")||s.includes("ok")?"badge-success":s.includes("defekt")?"badge-warning":"badge-secondary"},Za=(e,s)=>{const f=t(qt)==="asc"?1:-1,n=e[t(ut)]??"",N=s[t(ut)]??"";return typeof n=="number"&&typeof N=="number"?(n-N)*f:String(n).localeCompare(String(N),"de")*f};let ft=p(""),Bt=p("");const Z=p({}),rt=p({});ne(()=>{o($t,Ta()),o(la,ue()),U()}),oe(()=>t(R),()=>{o(yt,[...t(R)].sort(Za))}),le(),re();var da=Pe(),Ht=Kt(da),ca=i(Ht),_a=r(ca,2),ua=r(i(_a),2),Pt=i(ua),Ga=i(Pt,!0);a(Pt);var Ja=r(Pt,2);{var Ia=e=>{var s=fe(),f=i(s,!0);a(s),q(()=>g(f,(t($),l(()=>t($).time)))),c(e,s)};b(Ja,e=>{t($),l(()=>t($).time)&&e(Ia)})}a(ua),a(_a),a(Ht);var Qt=r(Ht,2),pa=i(Qt);{var Wa=e=>{var s=be(),f=r(i(s),2),n=i(f),N=r(i(n),2);H(N),a(n);var h=r(n,2),w=r(i(h),2);H(w),a(h);var k=r(h,2),nt=r(i(k),2);H(nt),a(k);var G=r(k,2),K=r(i(G),2);H(K),a(G);var A=r(G,2),V=r(i(A),2);H(V),a(A);var F=r(A,2),O=r(i(F),2);H(O),a(F);var st=r(F,2);{var gt=m=>{var ot=ge();c(m,ot)};b(st,m=>{t(x),l(()=>t(x).nfc_enabled)&&m(gt)})}Ma(2),a(f),a(s),P(N,()=>t(_t),m=>o(_t,m)),P(w,()=>t(Mt),m=>o(Mt,m)),P(nt,()=>t(Nt),m=>o(Nt,m)),P(K,()=>t(kt),m=>o(kt,m)),P(V,()=>t(Tt),m=>o(Tt,m)),P(O,()=>t(St),m=>o(St,m)),C("submit",f,ka(Ea)),c(e,s)};b(pa,e=>{B(),l(()=>{var s;return it((s=B())==null?void 0:s.role)})&&e(Wa)})}var fa=r(pa,2),ga=r(i(fa),2),Zt=i(ga),Gt=r(i(Zt),2);q(()=>{t(ut),sa(()=>{})});var Jt=i(Gt);Jt.value=Jt.__value="name";var It=r(Jt);It.value=It.__value="category";var Wt=r(It);Wt.value=Wt.__value="location";var Rt=r(Wt);Rt.value=Rt.__value="quantity";var jt=r(Rt);jt.value=jt.__value="min_quantity";var Ut=r(jt);Ut.value=Ut.__value="condition";var ba=r(Ut);ba.value=ba.__value="tag_id",a(Gt),a(Zt);var ma=r(Zt,2),Vt=r(i(ma),2);q(()=>{t(qt),sa(()=>{})});var Xt=i(Vt);Xt.value=Xt.__value="asc";var ha=r(Xt);ha.value=ha.__value="desc",a(Vt),a(ma),a(ga),a(fa),a(Qt);var Yt=r(Qt,2),Ra=i(Yt);{var ja=e=>{var s=me();c(e,s)},Ua=e=>{var s=na(),f=Kt(s);{var n=h=>{var w=he(),k=i(w,!0);a(w),q(()=>g(k,t(j))),c(h,w)},N=h=>{var w=na(),k=Kt(w);{var nt=K=>{var A=ye();c(K,A)},G=K=>{var A=qe(),V=i(A),F=i(V),O=i(F),st=r(i(O),6);{var gt=L=>{var _=we();c(L,_)};b(st,L=>{t(x),l(()=>t(x).nfc_enabled)&&L(gt)})}var m=r(st);{var ot=L=>{var _=Me();c(L,_)};b(m,L=>{B(),l(()=>{var _;return it((_=B())==null?void 0:_.role)})&&L(ot)})}a(O),a(F);var xt=r(F);At(xt,5,()=>t(yt),Ft,(L,_)=>{var X=Se(),Y=i(X),Dt=i(Y,!0);a(Y);var J=r(Y),lt=i(J),aa=i(lt,!0);a(lt),a(J);var tt=r(J),Lt=i(tt,!0);a(tt);var at=r(tt),ea=i(at,!0);a(at);var vt=r(at),ia=i(vt,!0);a(vt);var bt=r(vt),Et=i(bt),v=i(Et),d=i(v,!0);a(v);var M=r(v,2),et=i(M);{var S=y=>{var T=Ne();C("click",T,()=>Aa(t(_).tag_id)),c(y,T)};b(et,y=>{t(x),l(()=>t(x).nfc_enabled)&&y(S)})}a(M),a(Et),a(bt);var I=r(bt);{var W=y=>{var T=ke(),mt=i(T,!0);a(T),q(()=>g(mt,(t(_),l(()=>t(_).tag_id??"-")))),c(y,T)};b(I,y=>{t(x),l(()=>t(x).nfc_enabled)&&y(W)})}var dt=r(I);{var ct=y=>{var T=Te(),mt=i(T);a(T),C("click",mt,()=>Ka(t(_).id)),c(y,T)};b(dt,y=>{B(),l(()=>{var T;return it((T=B())==null?void 0:T.role)})&&y(ct)})}a(X),q(y=>{g(Dt,(t(_),l(()=>t(_).name))),g(aa,(t(_),l(()=>t(_).category))),g(Lt,(t(_),l(()=>t(_).location))),g(ea,(t(_),l(()=>t(_).quantity))),g(ia,(t(_),l(()=>t(_).min_quantity))),Na(v,1,y),g(d,(t(_),l(()=>t(_).condition)))},[()=>(t(_),l(()=>`badge ${Qa(t(_).condition)}`))]),c(L,X)}),a(xt),a(V),a(A),c(K,A)};b(k,K=>{t(yt),t(pt),l(()=>t(yt).length===0&&t(pt))?K(nt):K(G,!1)},!0)}c(h,w)};b(f,h=>{t(j)?h(n):h(N,!1)},!0)}c(e,s)};b(Ra,e=>{t(Ot)?e(ja):e(Ua,!1)})}a(Yt);var ta=r(Yt,2),ya=i(ta);{var Va=e=>{var s=Be(),f=r(i(s),2),n=i(f),N=r(i(n),2);H(N),a(n);var h=r(n,2),w=r(i(h),2);H(w),a(h),Ma(2),a(f),a(s),P(N,()=>t(ft),k=>o(ft,k)),P(w,()=>t(Bt),k=>o(Bt,k)),C("submit",f,ka(Fa)),c(e,s)};b(ya,e=>{B(),l(()=>{var s;return it((s=B())==null?void 0:s.role)})&&e(Va)})}var wa=r(ya,2),Xa=r(i(wa),2);{var Ya=e=>{var s=xe();c(e,s)},te=e=>{var s=ze();At(s,5,()=>t(wt),Ft,(f,n)=>{var N=Oe(),h=i(N),w=i(h),k=i(w),nt=i(k,!0);a(k);var G=r(k,2),K=i(G,!0);a(G),a(w);var A=r(w,2);{var V=v=>{var d=De();C("click",d,()=>Ca(t(n).id)),c(v,d)};b(A,v=>{B(),l(()=>{var d;return it((d=B())==null?void 0:d.role)})&&v(V)})}a(h);var F=r(h,2),O=i(F),st=i(O,!0);a(O);var gt=r(O,2);{var m=v=>{var d=Le();C("click",d,()=>za(t(n))),c(v,d)};b(gt,v=>{t(x),l(()=>t(x).nfc_enabled)&&v(m)})}a(F);var ot=r(F,2);{var xt=v=>{var d=Ee(),M=r(i(d),4),et=i(M,!0);a(M);var S=r(M,2),I=i(S);a(S);var W=r(S,2),dt=i(W),ct=r(dt,2);a(W),a(d),q(()=>{g(et,(t(n),l(()=>t(n).nfc_tag))),g(I,`Web-App-Modus: ${t(la)?"Aktiv":"Inaktiv"}`)}),C("click",dt,Ha),C("click",ct,Pa),c(v,d)};b(ot,v=>{t($t),t(zt),t(n),l(()=>t($t)&&t(zt)===t(n).id)&&v(xt)})}var L=r(ot,2);{var _=v=>{var d=Ke(),M=i(d,!0);a(d),q(()=>g(M,(t(D),t(n),l(()=>t(D)[t(n).id])))),c(v,d)};b(L,v=>{t(D),t(n),l(()=>t(D)[t(n).id])&&v(_)})}var X=r(L,2),Y=i(X),Dt=i(Y),J=r(Dt,2);q(()=>{t(Z),sa(()=>{t(n),t(R)})});var lt=i(J);lt.value=lt.__value="";var aa=r(lt);At(aa,1,()=>t(R),Ft,(v,d)=>{var M=Ae(),et=i(M,!0);a(M);var S={};q(()=>{g(et,(t(d),l(()=>t(d).name))),S!==(S=(t(d),l(()=>t(d).id)))&&(M.value=(M.__value=(t(d),l(()=>t(d).id)))??"")}),c(v,M)}),a(J),a(Y);var tt=r(Y,2),Lt=i(tt),at=r(Lt,2);H(at),a(tt);var ea=r(tt,2);a(X);var vt=r(X,2),ia=i(vt);{var bt=v=>{var d=na(),M=Kt(d);At(M,1,()=>(t(n),l(()=>t(n).materials)),Ft,(et,S)=>{var I=Ce(),W=i(I),dt=i(W,!0);a(W);var ct=r(W,2),y=i(ct),T=i(y,!0);a(y);var mt=r(y,2);{var ie=ra=>{var ht=Fe();C("click",ht,()=>Oa(t(n).id,t(S).id)),c(ra,ht)};b(mt,ra=>{B(),l(()=>{var ht;return it((ht=B())==null?void 0:ht.role)})&&ra(ie)})}a(ct),a(I),q(()=>{g(dt,(t(S),l(()=>t(S).name))),g(T,(t(S),l(()=>t(S).assigned_quantity)))}),c(et,I)}),c(v,d)},Et=v=>{var d=$e();c(v,d)};b(ia,v=>{t(n),l(()=>{var d;return(d=t(n).materials)==null?void 0:d.length})?v(bt):v(Et,!1)})}a(vt),a(N),q(()=>{g(nt,(t(n),l(()=>t(n).name))),g(K,(t(n),l(()=>t(n).description||"-"))),g(st,(t(n),l(()=>t(n).nfc_tag))),Ct(Dt,"for",(t(n),l(()=>`box-${t(n).id}-material`))),Ct(J,"id",(t(n),l(()=>`box-${t(n).id}-material`))),Ct(Lt,"for",(t(n),l(()=>`box-${t(n).id}-quantity`))),Ct(at,"id",(t(n),l(()=>`box-${t(n).id}-quantity`)))}),oa(J,()=>t(Z)[t(n).id],v=>z(Z,t(Z)[t(n).id]=v)),P(at,()=>t(rt)[t(n).id],v=>z(rt,t(rt)[t(n).id]=v)),C("click",ea,()=>$a(t(n).id)),c(f,N)}),a(s),c(e,s)};b(Xa,e=>{t(wt),l(()=>t(wt).length===0)?e(Ya):e(te,!1)})}a(wa),a(ta);var ae=r(ta,2);{var ee=e=>{var s=He(),f=i(s),n=i(f,!0);a(f),a(s),q(()=>g(n,t(E))),c(e,s)};b(ae,e=>{t(E)&&e(ee)})}q(()=>{Na(ca,1,(t($),l(()=>`activity-strip ${t($).type}`))),g(Ga,(t($),l(()=>t($).message)))}),oa(Gt,()=>t(ut),e=>o(ut,e)),oa(Vt,()=>t(qt),e=>o(qt,e)),c(Ba,da),ve(),La()}export{ei as component};
