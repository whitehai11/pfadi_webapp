import{a as c,f as d,s as x,c as mt,e as q,b as ct}from"../chunks/CXN8AEkE.js";import{i as Kt}from"../chunks/Ba5BHlZf.js";import{o as qt}from"../chunks/PPGuM6Ad.js";import{m as Ut,E as Wt,F as jt,n as R,o as Dt,r as s,q as i,s as p,a as t,t as e,v as P,w as z,u as v,x as bt}from"../chunks/DrZxtosp.js";import{i as b}from"../chunks/C09UTFEA.js";import{e as nt,i as lt}from"../chunks/BnX6E_pk.js";import{b as Qt}from"../chunks/DJ05b8fX.js";import{s as Rt}from"../chunks/CGYafap6.js";import{b as kt}from"../chunks/D0pToFsK.js";import{s as Xt,a as yt}from"../chunks/DbI0K5eF.js";import{a as U,s as Yt}from"../chunks/C0-kHXY5.js";import{s as Zt}from"../chunks/DpVb3R87.js";const ta=()=>{const $=Zt;return{page:{subscribe:$.page.subscribe},navigating:{subscribe:$.navigating.subscribe},updated:$.updated}},aa={subscribe($){return ta().page.subscribe($)}};var ea=d('<p class="text-muted"> </p>'),sa=d('<div class="card">Lade Packliste...</div>'),ra=d('<button class="btn btn-primary">Packliste erstellen</button>'),ia=d('<div class="card"><p>Keine Packliste vorhanden.</p> <!></div>'),oa=d('<p class="text-muted"> </p>'),na=d('<p class="text-muted">Alles gepackt.</p>'),la=d('<p class="text-muted">Keine offenen Packlisteneinträge.</p>'),ca=d("<li> </li>"),va=d("<ul></ul>"),da=ct('<svg width="12" height="12" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M9 16.2l-3.5-3.5 1.4-1.4L9 13.4l8.7-8.7 1.4 1.4z"></path></svg>'),pa=ct('<svg width="12" height="12" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8zm0-6a10 10 0 1 1 0 20 10 10 0 0 1 0-20z"></path></svg>'),_a=ct('<svg width="12" height="12" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2l9 18H3L12 2zm0 7v4h-1.5V9H12zm0 6v2h-1.5v-2H12z"></path></svg>'),ua=d('<div class="actions"><button class="btn btn-outline">Fehlt</button> <button class="btn btn-outline">Vorbereitet</button> <button class="btn btn-primary">Gepackt</button></div>'),ga=d('<article class="card"><div class="actions actions-between"><strong> </strong> <span><!> </span></div> <!></article>'),fa=d("<option> </option>"),ha=d('<section class="card"><h3 class="section-title">Packlisteneintrag hinzufügen</h3> <div class="form-grid"><div class="field"><label for="inventory">Material</label> <select id="inventory" class="select"><option>Bitte wählen</option><!></select></div> <div class="field"><label for="status">Status</label> <select id="status" class="select"><option>Fehlt</option><option>Vorbereitet</option><option>Gepackt</option></select></div> <button class="btn btn-primary">Hinzufügen</button></div></section>'),ma=d('<section class="card-grid grid-2"><div class="card"><div class="actions actions-between"><h3 class="section-title">Fortschritt</h3> <span class="badge badge-secondary"> </span></div> <progress class="progress-native" max="100"></progress> <p class="text-muted"> </p> <!></div> <div class="card"><h3 class="section-title">Was fehlt noch?</h3> <!></div></section> <section class="card"><h3 class="section-title">Packlisteneinträge</h3> <div class="card-grid"></div></section> <!>',1),ba=d('<section class="card"><h2 class="page-title">Packliste</h2> <!></section> <!>',1);function Ia($,vt){Ut(vt,!1);const dt=()=>yt(aa,"$page",pt),F=()=>yt(Yt,"$session",pt),[pt,wt]=Xt(),X=P();let W=P(null),k=P([]),M=P([]),Y=P(!0),H=P(""),I=P(""),V=P("missing");const Z=o=>o==="admin"||o==="materialwart",j=async()=>{p(Y,!0),p(H,"");try{p(W,await U(`/api/packlists/${t(X)}`)),p(k,t(W).items||[]),p(M,await U("/api/inventory"))}catch{p(H,"Packliste konnte nicht geladen werden.")}finally{p(Y,!1)}},xt=async()=>{try{await U(`/api/packlists/${t(X)}`,{method:"POST"}),await j()}catch{p(H,"Packliste konnte nicht erstellt werden.")}},Pt=async()=>{if(t(I))try{await U(`/api/packlists/${t(W).id}/items`,{method:"PUT",body:JSON.stringify({items:[{inventory_item_id:t(I),status:t(V)}]})}),p(I,""),p(V,"missing"),await j()}catch{p(H,"Packlisteneintrag konnte nicht hinzugefügt werden.")}},tt=async(o,u)=>{await U(`/api/packlists/items/${o}`,{method:"PATCH",body:JSON.stringify({status:u})}),await j()},zt=o=>o==="packed"?"badge-success":o==="prepared"?"badge-info":"badge-warning",_t=()=>{if(!t(k).length)return 0;const o=t(k).filter(u=>u.status==="packed").length;return Math.round(o/t(k).length*100)},D=()=>t(k).filter(o=>o.status!=="packed");qt(j),Wt(()=>dt(),()=>{p(X,dt().params.eventId)}),jt(),Kt();var ut=ba(),at=R(ut),$t=s(i(at),2);{var Mt=o=>{var u=ea(),et=i(u,!0);e(u),z(()=>x(et,t(H))),c(o,u)};b($t,o=>{t(H)&&o(Mt)})}e(at);var St=s(at,2);{var Bt=o=>{var u=sa();c(o,u)},Ft=o=>{var u=mt(),et=R(u);{var Ht=C=>{var L=ia(),A=s(i(L),2);{var E=S=>{var y=ra();q("click",y,xt),c(S,y)};b(A,S=>{F(),v(()=>{var y;return Z((y=F())==null?void 0:y.role)})&&S(E)})}e(L),c(C,L)},It=C=>{var L=ma(),A=R(L),E=i(A),S=i(E),y=s(i(S),2),Ct=i(y);e(y),e(S);var gt=s(S,2),st=s(gt,2),Lt=i(st);e(st);var Nt=s(st,2);{var Ot=n=>{var a=oa(),f=i(a);e(a),z(_=>x(f,`Noch offen: ${_??""}`),[()=>v(()=>D().length)]),c(n,a)},Tt=n=>{var a=na();c(n,a)};b(Nt,n=>{v(()=>D().length>0)?n(Ot):n(Tt,!1)})}e(E);var ft=s(E,2),Vt=s(i(ft),2);{var At=n=>{var a=la();c(n,a)},Et=n=>{var a=va();nt(a,5,()=>v(D),lt,(f,_)=>{var g=ca(),B=i(g,!0);e(g),z(h=>x(B,h),[()=>(t(M),t(_),v(()=>{var h;return((h=t(M).find(w=>w.id===t(_).inventory_item_id))==null?void 0:h.name)??t(_).inventory_item_id}))]),c(f,g)}),e(a),c(n,a)};b(Vt,n=>{v(()=>D().length===0)?n(At):n(Et,!1)})}e(ft),e(A);var rt=s(A,2),ht=s(i(rt),2);nt(ht,5,()=>t(k),lt,(n,a)=>{var f=ga(),_=i(f),g=i(_),B=i(g,!0);e(g);var h=s(g,2),w=i(h);{var G=l=>{var r=da();c(l,r)},J=l=>{var r=mt(),m=R(r);{var N=T=>{var ot=pa();c(T,ot)},O=T=>{var ot=_a();c(T,ot)};b(m,T=>{t(a),v(()=>t(a).status==="prepared")?T(N):T(O,!1)},!0)}c(l,r)};b(w,l=>{t(a),v(()=>t(a).status==="packed")?l(G):l(J,!1)})}var K=s(w);e(h),e(_);var Q=s(_,2);{var it=l=>{var r=ua(),m=i(r),N=s(m,2),O=s(N,2);e(r),q("click",m,()=>tt(t(a).id,"missing")),q("click",N,()=>tt(t(a).id,"prepared")),q("click",O,()=>tt(t(a).id,"packed")),c(l,r)};b(Q,l=>{F(),v(()=>{var r;return Z((r=F())==null?void 0:r.role)})&&l(it)})}e(f),z((l,r)=>{x(B,l),Rt(h,1,r),x(K,` ${t(a),v(()=>t(a).status)??""}`)},[()=>(t(M),t(a),v(()=>{var l;return((l=t(M).find(r=>r.id===t(a).inventory_item_id))==null?void 0:l.name)??t(a).inventory_item_id})),()=>(t(a),v(()=>`badge ${zt(t(a).status)}`))]),c(n,f)}),e(ht),e(rt);var Gt=s(rt,2);{var Jt=n=>{var a=ha(),f=s(i(a),2),_=i(f),g=s(i(_),2);z(()=>{t(I),bt(()=>{t(M)})});var B=i(g);B.value=B.__value="";var h=s(B);nt(h,1,()=>t(M),lt,(l,r)=>{var m=fa(),N=i(m);e(m);var O={};z(()=>{x(N,`${t(r),v(()=>t(r).name)??""} (${t(r),v(()=>t(r).location)??""})`),O!==(O=(t(r),v(()=>t(r).id)))&&(m.value=(m.__value=(t(r),v(()=>t(r).id)))??"")}),c(l,m)}),e(g),e(_);var w=s(_,2),G=s(i(w),2);z(()=>{t(V),bt(()=>{})});var J=i(G);J.value=J.__value="missing";var K=s(J);K.value=K.__value="prepared";var Q=s(K);Q.value=Q.__value="packed",e(G),e(w);var it=s(w,2);e(f),e(a),kt(g,()=>t(I),l=>p(I,l)),kt(G,()=>t(V),l=>p(V,l)),q("click",it,Pt),c(n,a)};b(Gt,n=>{F(),v(()=>{var a;return Z((a=F())==null?void 0:a.role)})&&n(Jt)})}z((n,a)=>{x(Ct,`${n??""}%`),Qt(gt,a),x(Lt,`${t(k),v(()=>t(k).length)??""} Packlisteneinträge insgesamt`)},[()=>v(_t),()=>v(_t)]),c(C,L)};b(et,C=>{t(W)?C(It,!1):C(Ht)})}c(o,u)};b(St,o=>{t(Y)?o(Bt):o(Ft,!1)})}c($,ut),Dt(),wt()}export{Ia as component};
