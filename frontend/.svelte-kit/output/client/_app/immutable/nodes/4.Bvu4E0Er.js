import{a as v,f,s as m,e as O,c as xa}from"../chunks/CXN8AEkE.js";import{i as ut}from"../chunks/Ba5BHlZf.js";import{o as bt}from"../chunks/PPGuM6Ad.js";import{m as _t,n as sa,w as E,o as mt,s,q as i,r,t as e,a,v as p,x as ft,z as ht,y as gt}from"../chunks/DrZxtosp.js";import{i as L}from"../chunks/C09UTFEA.js";import{e as Na,i as Va}from"../chunks/BnX6E_pk.js";import{a as Fa,r as j}from"../chunks/DJ05b8fX.js";import{s as Ga}from"../chunks/CGYafap6.js";import{b as Q,a as yt}from"../chunks/BMwTRFU8.js";import{b as wt}from"../chunks/D0pToFsK.js";import{b as xt}from"../chunks/DS51lxhO.js";import{p as kt}from"../chunks/CWmzcjye.js";import{s as St,a as Tt}from"../chunks/DbI0K5eF.js";import{a as V,s as Lt}from"../chunks/C0-kHXY5.js";var Dt=f('<button class="btn btn-outline" type="button">Abbrechen</button>'),Ot=f('<div class="card"><h3 class="section-title"> </h3> <form class="form-grid"><div class="field"><label for="title">Titel</label> <input id="title" class="input" required/></div> <div class="field"><label for="type">Typ</label> <select id="type" class="select"><option>Gruppenstunde</option><option>Lager</option><option>Aktion</option><option>Sonstiges</option></select></div> <div class="field"><label for="start">Start</label> <input id="start" class="input" type="datetime-local" required/></div> <div class="field"><label for="end">Ende</label> <input id="end" class="input" type="datetime-local" required/></div> <div class="field"><label for="location">Ort</label> <input id="location" class="input" required/></div> <div class="field"><label for="description">Beschreibung</label> <textarea id="description" class="textarea" rows="3"></textarea></div> <label class="toggle"><input type="checkbox"/> Packliste erforderlich</label> <div class="actions"><button class="btn btn-primary" type="submit">Speichern</button> <!></div></form></div>'),Et=f('<div class="card">Lade Termine...</div>'),Kt=f('<div class="card"> </div>'),qt=f('<button class="btn btn-primary" type="button">Termin anlegen</button>'),Pt=f('<div class="card empty-state"><h3 class="section-title">Noch keine Termine</h3> <p class="text-muted">Sobald ein Termin angelegt ist, erscheint er hier mit Teilnahme und Packliste.</p> <div class="actions"><a class="btn btn-outline">Kalender abonnieren</a> <!></div></div>'),zt=f('<div class="actions"><button class="icon-btn" type="button" aria-label="Bearbeiten"><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 17.25V20h2.75L17.81 8.94l-2.75-2.75L4 17.25zm15.71-9.04a1.003 1.003 0 0 0 0-1.42l-2.5-2.5a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 2.75 2.75 1.99-1.66z"></path></svg></button> <button class="icon-btn" type="button" aria-label="Löschen"><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 7h12l-1 14H7L6 7zm3-3h6l1 2H8l1-2z"></path></svg></button></div>'),Bt=f('<span class="badge badge-info">Packliste erforderlich</span>'),It=f('<p class="text-muted"> </p>'),At=f('<div class="actions actions-between"><span> </span> <span> </span></div>'),Nt=f('<article class="card"><div class="actions actions-between"><div><h3 class="section-title"> </h3> <p class="text-muted"> </p></div> <!></div> <div class="actions"><span> </span> <!></div> <p> </p> <p class="text-muted"> </p> <div class="card-grid grid-2"><div class="card"><h4 class="section-title">Teilnahme</h4> <p class="text-muted">Was kannst du dir vorstellen?</p> <div class="actions"><button class="btn btn-outline">Kann</button> <button class="btn btn-outline">Vielleicht</button> <button class="btn btn-outline">Kann nicht</button></div> <!></div> <div class="card"><h4 class="section-title">Rückmeldungen</h4> <div class="actions"><span class="badge badge-success"> </span> <span class="badge badge-info"> </span> <span class="badge badge-warning"> </span></div> <div class="card-grid"></div></div></div></article>'),Vt=f('<section class="card-grid grid-2"><div class="card"><h2 class="page-title">Kalender</h2> <div class="actions"><a class="btn btn-outline">Kalender abonnieren</a></div></div> <!></section> <section class="card-grid"><!></section>',1);function $t(Ja,Ma){_t(Ma,!1);const X=()=>Tt(Lt,"$session",Ua),[Ua,Ca]=St();let F=p([]),z=p({}),na=p(!0),G=p(""),B=p(null),la=p("/calendar.ics"),J=p(""),I=p("Gruppenstunde"),M=p(""),U=p(""),C=p(""),H=p(""),R=p(!1);const Y=async()=>{s(na,!0),s(G,"");try{s(F,await V("/api/calendar"));const t=await Promise.all(a(F).map(l=>V(`/api/calendar/${l.id}/availability`)));s(z,a(F).reduce((l,u,x)=>(l[u.id]=t[x],l),{}))}catch{s(G,"Kalender konnte nicht geladen werden.")}finally{s(na,!1)}},ka=()=>{s(B,null),s(J,""),s(I,"Gruppenstunde"),s(M,""),s(U,""),s(C,""),s(H,""),s(R,!1)},Sa=t=>{const l=new Date(t),u=l.getTimezoneOffset();return new Date(l.getTime()-u*6e4).toISOString().slice(0,16)};let oa=p(null);const Ha=()=>{var t;(t=a(oa))==null||t.scrollIntoView({behavior:"smooth",block:"start"})},Ra=async()=>{try{const t={title:a(J),type:a(I),start_at:new Date(a(M)).toISOString(),end_at:new Date(a(U)).toISOString(),location:a(C),description:a(H),packlist_required:a(R)};a(B)?await V(`/api/calendar/${a(B)}`,{method:"PUT",body:JSON.stringify(t)}):await V("/api/calendar",{method:"POST",body:JSON.stringify(t)}),ka(),await Y()}catch{s(G,"Termin konnte nicht gespeichert werden.")}},Wa=t=>{s(B,t.id),s(J,t.title),s(I,t.type),s(M,Sa(t.start_at)),s(U,Sa(t.end_at)),s(C,t.location),s(H,t.description),s(R,!!t.packlist_required)},ja=async t=>{confirm("Termin wirklich löschen?")&&(await V(`/api/calendar/${t}`,{method:"DELETE"}),await Y())},da=async(t,l)=>{await V(`/api/calendar/${t}/availability`,{method:"POST",body:JSON.stringify({status:l})}),await Y()},Ta=t=>{var x;const u=(((x=a(z)[t])==null?void 0:x.entries)??[]).find(K=>{var b;return K.user_id===((b=X())==null?void 0:b.id)});return(u==null?void 0:u.status)??null},La=t=>t==="yes"?"Kann":t==="maybe"?"Vielleicht":"Kann nicht",Qa=t=>t==="Lager"?"badge-warning":t==="Aktion"?"badge-info":t==="Sonstiges"?"badge-secondary":"badge-success";bt(()=>{typeof window<"u"&&s(la,window.location.origin.replace(/^https?/,"webcal")+"/calendar.ics"),Y()}),ut();var Da=Vt(),ca=sa(Da),va=i(ca),Oa=r(i(va),2),Xa=i(Oa);e(Oa),e(va);var Ya=r(va,2);{var Za=t=>{var l=Ot(),u=i(l),x=i(u,!0);e(u);var K=r(u,2),b=i(K),k=r(i(b),2);j(k),e(b);var q=r(b,2),pa=r(i(q),2);E(()=>{a(I),ft(()=>{})}),e(q);var W=r(q,2),S=r(i(W),2);j(S),e(W);var h=r(W,2),P=r(i(h),2);j(P),e(h);var D=r(h,2),n=r(i(D),2);j(n),e(D);var T=r(D,2),g=r(i(T),2);ht(g),e(T);var _=r(T,2),A=i(_);j(A),gt(),e(_);var Z=r(_,2),$=r(i(Z),2);{var ua=o=>{var aa=Dt();O("click",aa,ka),v(o,aa)};L($,o=>{a(B)&&o(ua)})}e(Z),e(K),e(l),xt(l,o=>s(oa,o),()=>a(oa)),E(()=>m(x,a(B)?"Termin bearbeiten":"Neuer Termin")),Q(k,()=>a(J),o=>s(J,o)),wt(pa,()=>a(I),o=>s(I,o)),Q(S,()=>a(M),o=>s(M,o)),Q(P,()=>a(U),o=>s(U,o)),Q(n,()=>a(C),o=>s(C,o)),Q(g,()=>a(H),o=>s(H,o)),yt(A,()=>a(R),o=>s(R,o)),O("submit",K,kt(Ra)),v(t,l)};L(Ya,t=>{var l;((l=X())==null?void 0:l.role)==="admin"&&t(Za)})}e(ca);var Ea=r(ca,2),$a=i(Ea);{var at=t=>{var l=Et();v(t,l)},tt=t=>{var l=xa(),u=sa(l);{var x=b=>{var k=Kt(),q=i(k,!0);e(k),E(()=>m(q,a(G))),v(b,k)},K=b=>{var k=xa(),q=sa(k);{var pa=S=>{var h=Pt(),P=r(i(h),4),D=i(P),n=r(D,2);{var T=g=>{var _=qt();O("click",_,Ha),v(g,_)};L(n,g=>{var _;((_=X())==null?void 0:_.role)==="admin"&&g(T)})}e(P),e(h),E(()=>Fa(D,"href",a(la))),v(S,h)},W=S=>{var h=xa(),P=sa(h);Na(P,1,()=>a(F),Va,(D,n)=>{var T=Nt(),g=i(T),_=i(g),A=i(_),Z=i(A,!0);e(A);var $=r(A,2),ua=i($);e($),e(_);var o=r(_,2);{var aa=c=>{var d=zt(),y=i(d),w=r(y,2);e(d),O("click",y,()=>Wa(a(n))),O("click",w,()=>ja(a(n).id)),v(c,d)};L(o,c=>{var d;((d=X())==null?void 0:d.role)==="admin"&&c(aa)})}e(g);var ba=r(g,2),ta=i(ba),et=i(ta,!0);e(ta);var it=r(ta,2);{var rt=c=>{var d=Bt();v(c,d)};L(it,c=>{a(n).packlist_required&&c(rt)})}e(ba);var _a=r(ba,2),st=i(_a,!0);e(_a);var ma=r(_a,2),nt=i(ma,!0);e(ma);var Ka=r(ma,2),fa=i(Ka),ha=r(i(fa),4),qa=i(ha),Pa=r(qa,2),lt=r(Pa,2);e(ha);var ot=r(ha,2);{var dt=c=>{var d=It(),y=i(d);e(d),E(w=>m(y,`Dein Status: ${w??""}`),[()=>La(Ta(a(n).id))]),v(c,d)};L(ot,c=>{Ta(a(n).id)&&c(dt)})}e(fa);var za=r(fa,2),ga=r(i(za),2),ya=i(ga),ct=i(ya);e(ya);var wa=r(ya,2),vt=i(wa);e(wa);var Ba=r(wa,2),pt=i(Ba);e(Ba),e(ga);var Ia=r(ga,2);Na(Ia,5,()=>{var c;return((c=a(z)[a(n).id])==null?void 0:c.entries)??[]},Va,(c,d)=>{var y=At(),w=i(y),ea=i(w,!0);e(w);var N=r(w,2),ia=i(N,!0);e(N),e(y),E(ra=>{m(ea,a(d).email),Ga(N,1,`badge ${a(d).status==="yes"?"badge-success":a(d).status==="maybe"?"badge-info":"badge-warning"}`),m(ia,ra)},[()=>La(a(d).status)]),v(c,y)}),e(Ia),e(za),e(Ka),e(T),E((c,d,y)=>{var w,ea,N,ia,ra,Aa;m(Z,a(n).title),m(ua,`${c??""} - ${d??""}`),Ga(ta,1,y),m(et,a(n).type),m(st,a(n).location),m(nt,a(n).description),m(ct,`Kann: ${((ea=(w=a(z)[a(n).id])==null?void 0:w.counts)==null?void 0:ea.yes)??0??""}`),m(vt,`Vielleicht: ${((ia=(N=a(z)[a(n).id])==null?void 0:N.counts)==null?void 0:ia.maybe)??0??""}`),m(pt,`Kann nicht: ${((Aa=(ra=a(z)[a(n).id])==null?void 0:ra.counts)==null?void 0:Aa.no)??0??""}`)},[()=>new Date(a(n).start_at).toLocaleString("de-DE"),()=>new Date(a(n).end_at).toLocaleString("de-DE"),()=>`badge ${Qa(a(n).type)}`]),O("click",qa,()=>da(a(n).id,"yes")),O("click",Pa,()=>da(a(n).id,"maybe")),O("click",lt,()=>da(a(n).id,"no")),v(D,T)}),v(S,h)};L(q,S=>{a(F).length===0?S(pa):S(W,!1)},!0)}v(b,k)};L(u,b=>{a(G)?b(x):b(K,!1)},!0)}v(t,l)};L($a,t=>{a(na)?t(at):t(tt,!1)})}e(Ea),E(()=>Fa(Xa,"href",a(la))),v(Ja,Da),mt(),Ca()}export{$t as component};
